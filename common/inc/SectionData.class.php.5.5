<?php
/*初始化常量*/
function init_config() {
	global $db, $bid, $bidinfo, $picserver, $uploadir, $ktitle, $keywords, $description;
	$webconfig = $db->fetch_array($db->query('select * from cg_config'));
	$picserver = $webconfig['picserver']; //图片服务器
	$uploadir = $webconfig['uploadir']; //图片目录
	if (empty ($bidinfo)) {
		$ktitle = $webconfig['name'];
		$keywords = $webconfig['keyes'];
		$description = $webconfig['contents'];
	} else {
		$ktitle = $bidinfo['ktitle'];
		$keywords = $bidinfo['keywords'];
		$description = $bidinfo['description'];
	}
}

/*
 *@types 0 国家 1 地区
 *@hits  1 热门
 *@classid1 地区分类
 *@classid 区域分类
 *@pid 国家分类
 * */

function cg_area($types = "", $hits = 0, $classid1 = 0, $classid = 0, $pid = 0) {
	global $db;
	$sqlwhere = '';
	if ($classid1) {
		$sqlwhere .= ' and classid1=' . $classid1;
	}
	if ($classid) {
		$sqlwhere .= ' and classid=' . $classid;
	}
	if ($pid) {
		$sqlwhere .= ' and pid=' . $pid;
	}
	if ($hits) {
		$sqlwhere .= ' and hits=1 ';
	}
	if ($types == '0' || !empty ($types)) {
		$sqlwhere .= ' and types=' . $types;
	}
	$query = $db->query("select * from cg_area where status=1 $sqlwhere order by id ");
	while ($row = $db->fetch_array($query)) {
		$data[$row['id']] = $row['title'];
	}
	return $data;
}

/*
 函数功能：一级分类数组
 参    数：$pid>>上级ID
 */
function cg_class($classtype = 0) {
	global $db;
	$sqlwhere = " and classtype=$classtype ";
	$query = $db->query("select * from cg_class where pid=0 $sqlwhere  order by hots");
	$shop = array ();
	while ($row = $db->fetch_array($query)) {
		$shop[] = $row;
	}
	return $shop;
}

/*
 函数功能：机构数组
 */
function cg_branch() {
	global $db;
	$sqlwhere = " where city>0 and myurl<>'' ";

	$query = $db->query("select * from cg_branch $sqlwhere  order by id ");
	$shop = array ();
	while ($row = $db->fetch_array($query)) {
		$shop[$row['city']] = $row['myurl'];
	}
	return $shop;
}

/*
 * 获取广告数据
 * */
function selectdatabanner($sectionID, $count) {
	global $db, $picserver, $siteurl, $bid;
	$orderbysql = ' order by hots ';
	if ($sectionID)
		$sqldataid .= ' and mid=' . $sectionID;
	if ($bid)
		$sqldataid .= ' and bid=' . $bid;
	if ($count)
		$limitsql = ' limit ' . $count;
	$sql = 'select * from cg_banner where status=1' . $sqldataid . $orderbysql . $limitsql;
	$query = $db->query($sql);
	while ($value = $db->fetch_array($query)) {
		if (!empty ($value['url'])) {
			$value['url'] = (stristr($value["url"], "http://") == '') ? $picserver . replaceSeps($value["url"]) : $value["url"];
		}
		$re[] = $value;
	}
	return $re;
}

/*
 * 获取友情链接数据
 * */
function selectdatalink($count) {
	global $db, $picserver, $siteurl, $bid;
	$orderbysql = ' order by hots ';

	if ($bid)
		$sqldataid .= ' and bid=' . $bid;
	if ($count)
		$limitsql = ' limit ' . $count;
	$sql = 'select * from cg_link where status=1' . $sqldataid . $orderbysql . $limitsql;
	$query = $db->query($sql);
	while ($value = $db->fetch_array($query)) {
		if (!empty ($value['url'])) {
			$value['url'] = (stristr($value["url"], "http://") == '') ? $picserver . replaceSeps($value["url"]) : $value["url"];
		}
		$re[] = $value;
	}
	return $re;
}

/*
 * 获取线路数据
 * */
function selectdataroute($count,$type=1,$classid = 0, $classid2 = 0) {
	global $db, $picserver, $siteurl, $bid;
	$orderbysql = ' order by hid desc';
	$sqladd .= " where 1 and find_in_set('".$type."',optype)";
	if ($bid)
		$sqldataid .= "";//' and bid=' . $bid;
	if ($count)
		$limitsql = ' limit ' . $count;
	$sql = "select * from (select p.*,t.hid,t.title name,t.departure,t.price1 price_1,t.price2 price_2,t.userid uid,t.op_type optype,t.op_user opuser,concat_ws(',',p.title,p.info_id,IFNULL(p.keywords,' '),IFNULL(p.remark,' ')) keyword from cg_product_route_sale t,cg_product_route p where t.id=p.id and p.id) result". $sqladd. $sqldataid . $orderbysql . $limitsql;
	//return $sql;
	$query = $db->query($sql);
	while ($value = $db->fetch_array($query)) {
		if (!empty ($value['url'])) {
			$value['url'] = (stristr($value["url"], "http://") == '') ? $picserver . replaceSeps($value["url"]) : $value["url"];
		}
		$re[] = $value;
	}
	return $re;
}

/*
 * 获取产品数据--武松
 * @types 0：酒店,1:商品,2:签证,3:门票,4:餐厅,5:新闻
 * */
function sel_product($count, $types = "", $ctype = 0, $ctype1 = 0, $pid = 0) {
	global $db, $picserver, $siteurl, $bid;;
	$sqlwhere = ' where 1=1';$orderbysql = ' order by id desc';
	if ($types == '0' || !empty ($types)) {
		$sqlwhere .= ' and types=' . $types;
	}
	if ($ctype) {
		$sqlwhere .= ' and ctype=' . $ctype;
	}
	if ($ctype1) {
		$sqlwhere .= ' and ctype1=' . $ctype1;
	}
	if ($pid) {
		$sqlwhere .= ' and pid=' . $pid;
	}
	if ($count)
		$limitsql = ' limit ' . $count;
	//
	$sql = "select id,title,info_id,url,price1,price2,word,info,keyword,bid from cg_scenic". $sqlwhere. $orderbysql . $limitsql;
	$query = $db->query($sql);//where bid=$bid
	
	while ($row = $db->fetch_array($query)) {
		if (!empty ($row['url'])) {
			$row['url'] = (stristr($row["url"], "http://") == '') ? $picserver . replaceSeps($row["url"]) : $row["url"];
		}
		$row['word'] = cut_utf8(str_replace("&nbsp;","",strip_tags($row['word'])), 70, '...');
		$data[] = $row;
	}
	return $data;
}
?>